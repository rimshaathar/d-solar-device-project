<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Solar IoT Device</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            color: white;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .ui-panel {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .ui-panel.minimized {
            transform: scale(0.8);
            opacity: 0.7;
        }

        .control-panel {
            top: 20px;
            left: 20px;
            width: 320px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 20px;
            z-index: 100;
        }

        .analytics-panel {
            top: 20px;
            right: 20px;
            width: 350px;
            padding: 20px;
            z-index: 100;
        }

        .diagnostic-panel {
            bottom: 20px;
            left: 20px;
            width: 280px;
            padding: 15px;
            z-index: 100;
        }

        .environmental-panel {
            bottom: 20px;
            right: 20px;
            width: 300px;
            padding: 15px;
            z-index: 100;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .panel-title {
            font-size: 16px;
            font-weight: bold;
            color: #60a5fa;
        }

        .minimize-btn {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-size: 14px;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .minimize-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
            animation: pulse 2s infinite;
        }

        .status-icon.warning { background: #f59e0b; box-shadow: 0 0 8px rgba(245, 158, 11, 0.5); }
        .status-icon.error { background: #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.5); }
        .status-icon.offline { background: #6b7280; box-shadow: none; animation: none; }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .control-grid.single {
            grid-template-columns: 1fr;
        }

        .control-btn {
            padding: 12px;
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .control-btn:hover {
            background: linear-gradient(145deg, #334155, #475569);
            border-color: #60a5fa;
            transform: translateY(-1px);
        }

        .control-btn.active {
            background: linear-gradient(145deg, #1d4ed8, #2563eb);
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .control-btn.warning {
            background: linear-gradient(145deg, #d97706, #f59e0b);
            border-color: #f59e0b;
        }

        .control-btn.error {
            background: linear-gradient(145deg, #dc2626, #ef4444);
            border-color: #ef4444;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(75, 85, 99, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .progress-fill.error {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .metric-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #374151;
            text-align: center;
        }

        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 10px;
            color: #94a3b8;
            text-transform: uppercase;
        }

        .chart-container {
            height: 120px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #374151;
            margin-bottom: 15px;
            position: relative;
        }

        .log-container {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #374151;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }

        .log-entry {
            margin-bottom: 4px;
            display: flex;
            gap: 8px;
        }

        .log-time {
            color: #6b7280;
            min-width: 60px;
        }

        .log-level {
            min-width: 50px;
            font-weight: bold;
        }

        .log-level.info { color: #3b82f6; }
        .log-level.warn { color: #f59e0b; }
        .log-level.error { color: #ef4444; }
        .log-level.success { color: #10b981; }

        .slider-container {
            margin: 10px 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #374151;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .camera-controls {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .camera-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .camera-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: scale(1.1);
        }

        .notification {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(10px);
        }

        .notification.warning {
            background: linear-gradient(135deg, #d97706, #f59e0b);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #60a5fa;
            font-size: 18px;
            z-index: 1000;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(55, 65, 81, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(96, 165, 250, 0.5);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(96, 165, 250, 0.8);
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading" id="loading">Initializing Advanced Solar IoT System...</div>
        
        <div class="notification" id="notification"></div>

        <!-- Main Control Panel -->
        <div class="ui-panel control-panel">
            <div class="panel-header">
                <div class="panel-title">🌟 System Control</div>
                <button class="minimize-btn" onclick="togglePanel(this)">−</button>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <div class="status-icon" id="system-status"></div>
                    Core Systems
                </div>
                <div class="control-grid">
                    <button class="control-btn active" onclick="toggleSystem('power')" data-system="power">
                        ⚡ Power
                    </button>
                    <button class="control-btn active" onclick="toggleSystem('solar')" data-system="solar">
                        ☀️ Solar
                    </button>
                    <button class="control-btn active" onclick="toggleSystem('wifi')" data-system="wifi">
                        📶 WiFi
                    </button>
                    <button class="control-btn active" onclick="toggleSystem('scan')" data-system="scan">
                        🔍 AI Scan
                    </button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    <div class="status-icon" id="subsystem-status"></div>
                    Subsystems
                </div>
                <div class="control-grid">
                    <button class="control-btn" onclick="toggleSystem('feeder')" data-system="feeder">
                        🍃 Auto Feed
                    </button>
                    <button class="control-btn" onclick="toggleSystem('water')" data-system="water">
                        💧 Water Pump
                    </button>
                    <button class="control-btn" onclick="toggleSystem('climate')" data-system="climate">
                        🌡️ Climate
                    </button>
                    <button class="control-btn" onclick="toggleSystem('security')" data-system="security">
                        🔒 Security
                    </button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">AI Vision Controls</div>
                <div class="control-grid single">
                    <button class="control-btn" onclick="triggerScan()">
                        🎯 Manual Scan
                    </button>
                    <button class="control-btn" onclick="toggleNightVision()">
                        🌙 Night Vision
                    </button>
                    <button class="control-btn" onclick="calibrateCamera()">
                        ⚙️ Calibrate Camera
                    </button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Automation</div>
                <div class="slider-container">
                    <label style="font-size: 11px; color: #94a3b8;">Feed Schedule (hours)</label>
                    <input type="range" min="1" max="24" value="6" class="slider" id="feed-schedule" onchange="updateSchedule(this)">
                    <div style="font-size: 10px; color: #60a5fa; text-align: center; margin-top: 4px;">
                        Every <span id="feed-hours">6</span> hours
                    </div>
                </div>
                <div class="slider-container">
                    <label style="font-size: 11px; color: #94a3b8;">Scan Sensitivity</label>
                    <input type="range" min="1" max="10" value="7" class="slider" id="scan-sensitivity" onchange="updateSensitivity(this)">
                </div>
            </div>
        </div>

        <!-- Analytics Panel -->
        <div class="ui-panel analytics-panel">
            <div class="panel-header">
                <div class="panel-title">📊 Analytics</div>
                <button class="minimize-btn" onclick="togglePanel(this)">−</button>
            </div>

            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value" id="energy-generated">847</div>
                    <div class="metric-label">kWh Generated</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="efficiency">94</div>
                    <div class="metric-label">Efficiency %</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="scans-today">156</div>
                    <div class="metric-label">Scans Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="uptime">99.8</div>
                    <div class="metric-label">Uptime %</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Power Management</div>
                <div style="margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 11px;">
                    <span>Solar Charge</span>
                    <span id="solar-percentage">87%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="solar-progress" style="width: 87%;"></div>
                </div>
                
                <div style="margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 11px;">
                    <span>Battery Level</span>
                    <span id="battery-percentage">92%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="battery-progress" style="width: 92%;"></div>
                </div>

                <div style="margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 11px;">
                    <span>Water Tank</span>
                    <span id="water-percentage">75%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="water-progress" style="width: 75%;"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Performance Chart</div>
                <div class="chart-container" id="performance-chart">
                    <canvas id="chart-canvas" width="310" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Diagnostic Panel -->
        <div class="ui-panel diagnostic-panel">
            <div class="panel-header">
                <div class="panel-title">🔧 Diagnostics</div>
                <button class="minimize-btn" onclick="togglePanel(this)">−</button>
            </div>

            <div class="section">
                <div class="section-title">System Health</div>
                <div style="font-size: 11px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>CPU Usage:</span>
                        <span id="cpu-usage">23%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Memory:</span>
                        <span id="memory-usage">456/1024 MB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Temperature:</span>
                        <span id="device-temp">31°C</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Network:</span>
                        <span id="network-status">Connected</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Quick Actions</div>
                <div class="control-grid single">
                    <button class="control-btn" onclick="runDiagnostic()">
                        🔍 Run Full Diagnostic
                    </button>
                    <button class="control-btn" onclick="restartSystem()">
                        🔄 Restart System
                    </button>
                    <button class="control-btn" onclick="exportLogs()">
                        📋 Export Logs
                    </button>
                </div>
            </div>
        </div>

        <!-- Environmental Panel -->
        <div class="ui-panel environmental-panel">
            <div class="panel-header">
                <div class="panel-title">🌍 Environment</div>
                <button class="minimize-btn" onclick="togglePanel(this)">−</button>
            </div>

            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value" id="ambient-temp">24°C</div>
                    <div class="metric-label">Temperature</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="humidity">68%</div>
                    <div class="metric-label">Humidity</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="light-level">850</div>
                    <div class="metric-label">Light (lux)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="wind-speed">12</div>
                    <div class="metric-label">Wind km/h</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Activity Log</div>
                <div class="log-container" id="activity-log">
                    <div class="log-entry">
                        <span class="log-time">15:42</span>
                        <span class="log-level info">INFO</span>
                        <span>System initialized successfully</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">15:43</span>
                        <span class="log-level success">SCAN</span>
                        <span>Object detected and classified</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">15:44</span>
                        <span class="log-level info">FEED</span>
                        <span>Automatic feeding cycle started</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Camera Controls -->
        <div class="camera-controls">
            <button class="camera-btn" onclick="setView('front')" title="Front View">👁️</button>
            <button class="camera-btn" onclick="setView('top')" title="Top View">⬆️</button>
            <button class="camera-btn" onclick="setView('side')" title="Side View">↔️</button>
            <button class="camera-btn" onclick="setView('iso')" title="Isometric">🎯</button>
            <button class="camera-btn" onclick="toggleAutoRotate()" title="Auto Rotate">🔄</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Global variables
        let scene, camera, renderer, device, solarPanel, antenna, display, feeder;
        let scanningRing, wifiLight, powerLight, waterTank, climateModule;
        let autoRotate = true;
        let particleSystem, environmentSphere;
        
        // System states
        let systems = {
            power: true, solar: true, wifi: true, scan: true,
            feeder: false, water: false, climate: false, security: false
        };
        
        // Performance data
        let performanceData = [];
        let chartContext;

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 10, 50);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(8, 6, 12);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.4;
            
            document.getElementById('container').appendChild(renderer.domElement);

            // Setup everything
            setupLighting();
            createEnvironment();
            createDevice();
            createParticleSystem();
            initializeChart();
            
            // Start simulation loops
            animate();
            startDataSimulation();
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            showNotification('System Online', 'success');
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);

            // Main directional light (sun)
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
            sunLight.position.set(15, 15, 10);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 4096;
            sunLight.shadow.mapSize.height = 4096;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 100;
            sunLight.shadow.camera.left = -20;
            sunLight.shadow.camera.right = 20;
            sunLight.shadow.camera.top = 20;
            sunLight.shadow.camera.bottom = -20;
            scene.add(sunLight);

            // Blue tech accent light
            const techLight = new THREE.PointLight(0x3b82f6, 0.8, 30);
            techLight.position.set(-8, 5, 8);
            scene.add(techLight);

            // Green environment light
            const envLight = new THREE.PointLight(0x10b981, 0.6, 25);
            envLight.position.set(8, 3, -8);
            scene.add(envLight);

            // Spotlight for dramatic effect
            const spotLight = new THREE.SpotLight(0x60a5fa, 1, 50, Math.PI * 0.1, 0.5);
            spotLight.position.set(0, 20, 0);
            spotLight.target.position.set(0, 0, 0);
            spotLight.castShadow = true;
            scene.add(spotLight);
            scene.add(spotLight.target);
        }

        function createEnvironment() {
            // Advanced ground with texture
            const groundGeometry = new THREE.PlaneGeometry(50, 50, 50, 50);
            const groundMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a1a2e,
                roughness: 0.9,
                metalness: 0.1
            });
            
            // Add some height variation to ground
            const vertices = groundGeometry.attributes.position.array;
            for (let i = 0; i < vertices.length; i += 3) {
                vertices[i + 2] = Math.random() * 0.3;
            }
            groundGeometry.attributes.position.needsUpdate = true;
            groundGeometry.computeVertexNormals();
            
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Environment sphere for atmospheric effects
            const sphereGeometry = new THREE.SphereGeometry(40, 32, 32);
            const sphereMaterial = new THREE.MeshBasicMaterial({
                color: 0x0f172a,
                transparent: true,
                opacity: 0.3,
                side: THREE.BackSide
            });
            environmentSphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            scene.add(environmentSphere);
        }

        function createDevice() {
            device = new THREE.Group();

            // Enhanced main housing with more detail
            const housingGeometry = new THREE.BoxGeometry(7, 2, 5);
            const housingMaterial = new THREE.MeshStandardMaterial({
                color: 0xe5e7eb,
                metalness: 0.2,
                roughness: 0.4,
                envMapIntensity: 0.5
            });
            const housing = new THREE.Mesh(housingGeometry, housingMaterial);
            housing.castShadow = true;
            housing.receiveShadow = true;
            device.add(housing);

            // Housing details and vents
            for (let i = 0; i < 6; i++) {
                const ventGeometry = new THREE.BoxGeometry(0.1, 0.1, 4.5);
                const ventMaterial = new THREE.MeshStandardMaterial({ color: 0x374151 });
                const vent = new THREE.Mesh(ventGeometry, ventMaterial);
                vent.position.set(-3.2 + i * 0.3, 1.05, 0);
                device.add(vent);
            }

            createAdvancedSolarPanel();
            createEnhancedDisplay();
            createSmartAntenna();
            createAut
